<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PJM LMP Map</title>
  <link rel="icon" href="/static/favicon_lmp_32.png" type="image/png">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>

  <!-- Mapbox CSS (kept for 3D view) -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>

  <!-- APPLICATION LAYOUT: header -> map -> controls -> plot -->
  <header id="header">
    <h1>PJM Locational Marginal Price Map</h1>
    <p>Visualizing historical LMP data across PJM zones | <strong>Ctrl+Click</strong> to select zones</p>
  </header>

  <button id="filter-toggle" aria-expanded="false">‚öôÔ∏è Filters</button>

  <aside id="filter-panel" aria-hidden="true">
    <button id="close-filter" aria-label="Close filters">&times;</button>
    <h3>Date & Time Range Filter</h3>

    <section class="filter-section">
      <h4>Date Range</h4>
      <div class="date-inputs">
        <div class="date-input-row">
          <label for="start-date">Start:</label>
          <input type="date" id="start-date">
        </div>
        <div class="date-input-row">
          <label for="end-date">End:</label>
          <input type="date" id="end-date">
        </div>
      </div>
    </section>

    <section class="filter-section">
      <h4>Price Type</h4>
      <select id="price-type-select" class="custom-select">
        <option value="RT">Real-Time</option>
        <option value="DA">Day-Ahead</option>
        <option value="NET" selected>Net</option>
      </select>
    </section>

    <section class="filter-section">
      <h4>Days of Week</h4>
      <div class="days-container">
        <button class="day-button" data-day="0">Sun</button>
        <button class="day-button" data-day="1">Mon</button>
        <button class="day-button" data-day="2">Tue</button>
        <button class="day-button" data-day="3">Wed</button>
        <button class="day-button" data-day="4">Thu</button>
        <button class="day-button" data-day="5">Fri</button>
        <button class="day-button" data-day="6">Sat</button>
      </div>
    </section>

    <section class="filter-section">
      <h4>Time Range</h4>
      <div id="time-display">--:-- ‚Äì --:--</div>
      <div id="time-slider-container">
        <svg id="time-slider-svg" width="100%" height="80" role="img" aria-label="Time slider"></svg>
      </div>
    </section>

    <button class="apply-filter-btn" id="apply-filter">üîç Apply Filter & Load Data</button>
    <button class="apply-filter-btn" id="save-filter" style="background: #17a2b8;">üíæ Save Current Filter</button>

    <div class="saved-filters">
      <h4>Saved Filters</h4>
      <div id="saved-filters-list">
        <div style="color: #666; font-style: italic; font-size: 12px;">No saved filters yet</div>
      </div>
    </div>
  </aside>

  <main id="main">
    <!-- Map Container -->
    <div id="map-container" aria-live="polite">
      <div id="map" role="application" aria-label="LMP map"></div>
      <div id="map-3d" aria-hidden="true"></div>

      <!-- Selected Zones Panel (floats on map) -->
      <div id="selected-zones-panel" aria-live="polite">
        <div id="selected-zones-list"></div>
      </div>
    </div>

    <!-- Timeline Controls -->
    <div id="controls-container">
      <button id="play-pause-button">‚ñ∂ Play</button>
      <input type="range" id="hour-slider" min="0" max="0" value="0" step="1" aria-label="Hour slider">
      <div id="current-time-display">Click "Apply Filter & Load Data" to begin</div>
    </div>

    <!-- Observable Plot Container - OUTSIDE controls container -->
    <section id="plot-container">
      <div id="plot-header">
        <h3>Selected Zones Data</h3>
        <div id="plot-controls">
          <button id="show-table" class="plot-btn" title="Switch to table view">Show Table</button>
          <button id="show-chart" class="plot-btn" title="Switch to chart view" style="display:none">Show Chart</button>
          <button id="hide-plot" class="plot-btn" title="Hide panel">‚úñ Hide</button>
        </div>
      </div>

      <div id="plot-content" aria-live="polite">
        <div id="observable-plot"></div>
      </div>
    </section>
  </main>

  <!-- Libraries -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <!-- Observable Plot must load before our observablePlot.js -->
  <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6"></script>

  <!-- App scripts (order matters) -->
  <script src="/static/js/config.js"></script>
  <script src="/static/js/state.js"></script>
  <script src="/static/js/map.js"></script>
  <script src="/static/js/filters.js"></script>
  <script src="/static/js/timeSlider.js"></script>
  <script src="/static/js/csv.js"></script>
  <script src="/static/js/api.js"></script>
  <script src="/static/js/animation.js"></script>
  <script src="/static/js/viewToggle.js"></script>
  <script src="/static/js/zoneSelection.js"></script>

  <!-- Our rewritten file -->
  <script src="/static/js/observablePlot.js"></script>

  <!-- Main (bootstraps UI after DOMReady) -->
  <script src="/static/js/main.js"></script>
</body>
</html>
